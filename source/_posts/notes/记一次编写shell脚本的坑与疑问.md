---
title: è®°ä¸€æ¬¡ç¼–å†™shellè„šæœ¬çš„å‘ä¸Žç–‘é—®
date: 2019-01-05 17:09:26
categories: ç¬”è®°
tags: [shell,ç–‘é—®,ç¬”è®°]
---

å¯¹äºŽshellè„šæœ¬è¯­è¨€ï¼Œç†Ÿæ‚‰çš„ä¹Ÿå°±é‚£å‡ ä¸ªå¸¸ç”¨çš„Linuxå‘½ä»¤æ¯”å¦‚å­—ç¬¦ä¸²å¤„ç†ã€è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ï¼Œå¹¶æ²¡æœ‰åšè¿‡ç›¸å…³çš„é¡¹ç›®å¼€å‘ï¼Œä½†æ˜¯è®©æˆ‘åšäº›ç®€å•çš„éœ€æ±‚ï¼Œæœ‰æ€è·¯åŽç»“åˆæœç´¢å¼•æ“Žä¹Ÿèƒ½å¤„ç†ï¼Œå°±æ˜¯ä¼šè€—è´¹æ›´é•¿ä¸€ç‚¹çš„æ—¶é—´ã€‚ä»Šå¤©ä¼Ÿå“¥è®©æˆ‘å¸®ä»–å¼„ä¸€ä¸ªæ—¥å¿—å¤„ç†çš„è„šæœ¬ï¼Œè®°å½•ä¸‹å…¶ä¸­é‡åˆ°çš„çš„ä¸€äº›å‘å’Œç–‘é—®ã€‚äº§ç”Ÿè¿™äº›ç–‘é—®çš„ä¸»è¦åŽŸå› è¿˜æ˜¯ä¼šæ½œç§»é»˜åŒ–çš„æŠŠjavaç¼–ç¨‹ä¹ æƒ¯ä»£å…¥åˆ°shellç¼–ç¨‹é‡Œé¢ï¼Œæ™•ðŸ˜µï¼

### éœ€æ±‚

ä¸€ä¸ªæ ¼å¼å¦‚ä¸‹æ—¥å¿—æ–‡ä»¶ï¼Œéœ€è¦ç»Ÿè®¡æ¯ä¸€è¡Œçš„` ç«–çº¿|`ä¸ºåˆ†éš”åŽçš„æœ€åŽä¸€ä¸ªæ•°å­—ä¸Ž200å¤§å°æ•°é‡

```
00000000|111111|222222222|333333333|44444444444|555555|666666|21
00000000|111111|222222222|333333333|44444444444|555555|666666|254
00000000|111111|222222222|333333333|44444444444|555555|666666|200
00000000|111111|222222222|333333333|44444444444|555555|666666|763
00000000|111111|222222222|333333333|44444444444|555555|666666|23
00000000|111111|222222222|333333333|44444444444|555555|666666|6754
00000000|111111|222222222|333333333|44444444444|555555|666666|7685
00000000|111111|222222222|333333333|44444444444|555555|666666|36
00000000|111111|222222222|333333333|44444444444|555555|666666|223
00000000|111111|222222222|333333333|44444444444|555555|666666|856
00000000|111111|222222222|333333333|44444444444|555555|666666|200
00000000|111111|222222222|333333333|44444444444|555555|666666|77
```

### ä»£ç 

```shell
#!/bin/bash
#è®¡æ•°å™¨
big=0
small=0
eq=0
#è¯»å–æ–‡ä»¶æŒ‰è¡Œå¤„ç†ï¼Œ$1ä¸ºéœ€è¦å¤„ç†çš„æ–‡ä»¶
cat $1 | while read line
do
	string=$line
	echo å½“å‰è¡Œæ•°æ®$line
	#arr=(${string//|/})

	#æŒ‰ç…§`|`åˆ‡æˆæ•°ç»„
	OLD_IFS="$IFS"
	IFS="|"
	arr=($line)
	IFS="$OLD_IFS"

	length=${#arr[@]}
	echo å½“å‰æ•°ç»„é•¿$length
	
	#èŽ·å–æœ€åŽä¸€ä¸ªå…ƒç´ 
	thisnum=${arr[length-1]}
	if test $thisnum -eq 200
	then
		let eq++
		echo $thisnumç­‰äºŽ200
	elif test $thisnum -gt 200
	then
		let big++
		echo $thisnumå¤§äºŽ200
	else
		let small++
		echo $thisnumå°äºŽ200
	fi
	echo
done
echo --------done--------
echo å¤§äºŽ200çš„æ•°é‡ï¼š$big
echo ç­‰äºŽ200çš„æ•°é‡ï¼š$eq
echo å°äºŽ200çš„æ•°é‡ï¼š$small
echo ------ç»Ÿè®¡å®Œæˆ-------
```

### å‘å’Œç–‘é—®

1. doneåŽé¢æ‰“å‡ºæ¥çš„ç»“æžœæœªè¢«whileå¾ªçŽ¯é‡Œé¢ä¿®æ”¹

   ```shell
   --------done---------
   å¤§äºŽ200çš„æ•°é‡ï¼š0
   ç­‰äºŽ200çš„æ•°é‡ï¼š0
   å°äºŽ200çš„æ•°é‡ï¼š0
   ------ç»Ÿè®¡å®Œæˆ-------
   ```

   æ­¤å¤„æ˜¯å› ä¸ºä½¿ç”¨whileå¾ªçŽ¯ï¼Œæ”¹æˆforå¾ªçŽ¯å°±èƒ½æ­£å¸¸ä¿®æ”¹`big/eq/small`çš„å€¼

   ```shell
   --------done---------
   å¤§äºŽ200çš„æ•°é‡ï¼š9
   ç­‰äºŽ200çš„æ•°é‡ï¼š1
   å°äºŽ200çš„æ•°é‡ï¼š2
   ------ç»Ÿè®¡å®Œæˆ-------
   ```

   ä»¥ä¸‹2019-01-06æ›´æ–°ï¼š

   æ„Ÿè°¢@[Mabbs](https://github.com/Mabbs)çš„å›žç­”ï¼ŒæŸ¥äº†ä¸€ä¸‹ç®¡é“ç›¸å…³çš„èµ„æ–™ã€‚

   ä½¿ç”¨for line in `cat $1` å’Œ`while read line`æ—¶æ“ä½œåœ¨åŒä¸€ä¸ªè¿›ç¨‹å†…ã€‚å½“ä½¿ç”¨`cat $1 | while read line`æ—¶ï¼Œ`while read line`ä¼šforkä¸€ä¸ªå­è¿›ç¨‹ï¼Œæ— æ³•å…±äº«çˆ¶è¿›ç¨‹å£°æ˜Žçš„å˜é‡ã€‚

   æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½åç®¡é“å®žçŽ°å­è¿›ç¨‹å˜é‡å­˜å‚¨åˆ°å‘½åç®¡é“ï¼Œç»“æŸåŽè¿›ç¨‹å†è¯»å–çš„æ–¹å¼ã€‚

   ```shell
   #!/bin/bash
   mkfifo ppp
   big=0
   small=0
   eq=0
   
   cat $1 | while read line
   #for line in `cat $1`
   do
     string=$line
     echo å½“å‰è¡Œæ•°æ®$line
     #arr=(${string//|/})
   
     OLD_IFS="$IFS"
     IFS="|"
     arr=($line)
     IFS="$OLD_IFS"
   
     length=${#arr[@]}
     echo å½“å‰æ•°ç»„é•¿$length
   
     thisnum=${arr[length-1]}
     if test $thisnum -eq 200
       then
           let eq++
           echo $thisnumç­‰äºŽ200
       elif test $thisnum -gt 200
       then
           let big++
           echo $thisnumå¤§äºŽ200
      else
           let small++
           echo $thisnumå°äºŽ200
     fi
   echo ---------------------
   echo $big $eq $small > ppp
   done
   read big eq small < ppp
   echo --------done---------
   echo å¤§äºŽ200çš„æ•°é‡ï¼š$big
   echo ç­‰äºŽ200çš„æ•°é‡ï¼š$eq
   echo å°äºŽ200çš„æ•°é‡ï¼š$small
   echo ------ç»Ÿè®¡å®Œæˆ-------
   ```

   åœ¨å®žé™…ä½¿ç”¨ä¸­ï¼Œå¦‚æžœæ²¡æœ‰å­çˆ¶ç®¡é“çš„ä½¿ç”¨éœ€æ±‚çš„è¯ï¼Œæ³¨æ„ä¸è¦ä½¿ç”¨ç›¸å…³ç®¡é“ç¬¦å³å¯ã€‚

2. åˆ‡æ•°ç»„çš„æ—¶å€™ä½¿ç”¨å¦ä¸€ç§æ–¹å¼ï¼Œæ•ˆæžœæ˜¯åªæŠŠ`|`åŽ»æŽ‰ï¼Œæ•°ç»„é•¿åº¦ä¸º1

   ```shell
   #åˆ‡å‰²æ–¹å¼
   arr=(${string//|/})
   #ç»“æžœ
   000000001111112222222223333333334444444444455555566666621
   ```

   è¿™ä¸ªé—®é¢˜ä¸çŸ¥ä¸ºä½•ï¼Œéš¾é“ä½¿ç”¨æ–¹å¼ä¸å¯¹ï¼Ÿ

   ä»¥ä¸‹2019-01-06æ›´æ–°ï¼š

   æžœç„¶æ˜¯å‘å•Šï¼Œå°‘ä¸ªç©ºæ ¼ï¼ï¼ï¼ï¼ðŸ˜¡ðŸ˜¡ðŸ˜¡ðŸ˜¡ðŸ˜¡ðŸ˜¡

   ç„¶åŽåˆ‡å‰²åŽçš„æ•°ç»„å¿…é¡»é‡æ–°å–å€¼åŽæ‰å¯èŽ·å¾—é•¿åº¦ï¼Œæ¼”ç¤ºæƒ…å†µ

   ```shell
   #!/bin/bash
   while read line
   do
       string=$line
       str=${string//|/ }
       echo str é•¿åº¦: ${#str[@]}
   	echo $str--${str[*]}
       
       echo ------èµ‹å€¼ç»™ arr-----
       arr=($str)
       echo arr é•¿åº¦ï¼š${#arr[@]}
       echo $arr--${arr[*]}
   done
   ```

   ç»“æžœ

   ```shell
   str é•¿åº¦: 1
   99 2 3 4 5 6 7--99 2 3 4 5 6 7
   ------èµ‹å€¼ç»™ arr-----
   arr é•¿åº¦ï¼š7
   99--99 2 3 4 5 6 7
   ```

   è§£æž

   ```shell
   #!/bin/bash
   while read line
   do
       string=$line				#99|2|3|4|5|6|7
       str=${string//|/ }			#"99 2 3 4 5 6 7",strå­—ç¬¦ä¸²ç±»åž‹
       echo str é•¿åº¦: ${#str[@]}
   	echo $str--${str[*]}		
       
       echo ------èµ‹å€¼ç»™ arr-----
       arr=($str)					#(99 2 3 4 5 6 7)ï¼Œarræ•°ç»„ç±»åž‹
       echo arr é•¿åº¦ï¼š${#arr[@]}
       echo $arr--${arr[*]}		#$arré»˜è®¤æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ 
   done
   ```

   ç»ˆäºŽæŠŠshellè¿™äº›ç–‘é—®è§£å†³äº†ï¼


### æœ€ç»ˆä»£ç 

```shell
#!/bin/bash

#è¯»å–æ–‡ä»¶æŒ‰è¡Œå¤„ç†
#for line in `cat $1`
while read line
do
	string=$line
	echo å½“å‰è¡Œæ•°æ®$line
	#arr=(${string//|/})

	#æŒ‰ç…§`|`åˆ‡æˆæ•°ç»„
	OLD_IFS="$IFS"
	IFS="|"
	arr=($line)
	IFS="$OLD_IFS"

	length=${#arr[@]}
	echo å½“å‰æ•°ç»„é•¿$length

	thisnum=${arr[length-1]}
	if test $thisnum -eq 200
	then
		let eq++
		echo $thisnumç­‰äºŽ200
	elif test $thisnum -gt 200
	then
		let big++
		echo $thisnumå¤§äºŽ200
	else
		let small++
		echo $thisnumå°äºŽ200
	fi
	echo ---------------------
done
echo --------done---------
echo å¤§äºŽ200çš„æ•°é‡ï¼š$big
echo ç­‰äºŽ200çš„æ•°é‡ï¼š$eq
echo å°äºŽ200çš„æ•°é‡ï¼š$small
echo ------ç»Ÿè®¡å®Œæˆ--------
```

ä½¿ç”¨æ–¹æ³•

```shell
linux ç®¡é“: cat log.txt | ./log_calc.sh
bash æ ‡å‡†è¾“å…¥å¯¼å…¥ ./log_calc.sh < log.txt
ç›´æŽ¥åœ¨ bash ä¸­è¾“å…¥ä¸€æ¡ä¿¡æ¯æµ‹è¯• ./log_calc.sh <<< '000|111|2222|333|444|555555|666666|6754'
```

ç»“æžœ

```shell
--------done---------
å¤§äºŽ200çš„æ•°é‡ï¼š9
ç­‰äºŽ200çš„æ•°é‡ï¼š1
å°äºŽ200çš„æ•°é‡ï¼š2
------ç»Ÿè®¡å®Œæˆ-------
```



### èµ„æ–™

[bashä¸­ä¸€æ¬¡æ€§ç»™å¤šä¸ªå˜é‡èµ‹å€¼â€“å‘½åç®¡é“çš„ä½¿ç”¨](https://xingtingyang.com/558.html)

[å–„äºŽä½¿ç”¨ bash builtin -- read](http://blog.crhan.com/2013/01/%E5%96%84%E4%BA%8E%E4%BD%BF%E7%94%A8-bash-builtin-read/)



